<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1183px" preserveAspectRatio="none" style="width:1004px;height:1183px;background:#FFFFFF;" version="1.1" viewBox="0 0 1004 1183" width="1004px" zoomAndPan="magnify"><defs><filter height="300%" id="fabgl8ab4fgch" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fabgl8ab4fgch)" height="226.7266" style="stroke:#000000;stroke-width:2.0;" width="485" x="10" y="57.2969"/><rect fill="#FFFFFF" filter="url(#fabgl8ab4fgch)" height="226.7266" style="stroke:#000000;stroke-width:2.0;" width="528.5" x="156.5" y="337.1563"/><rect fill="#FFFFFF" filter="url(#fabgl8ab4fgch)" height="226.7266" style="stroke:#000000;stroke-width:2.0;" width="504" x="319" y="577.8828"/><rect fill="#FFFFFF" filter="url(#fabgl8ab4fgch)" height="226.7266" style="stroke:#000000;stroke-width:2.0;" width="833.5" x="156.5" y="818.6094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="51" x2="51" y1="40.2969" y2="1140.6016"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="228.5" x2="228.5" y1="40.2969" y2="1140.6016"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="407" x2="407" y1="40.2969" y2="1140.6016"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="585" x2="585" y1="40.2969" y2="1140.6016"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="757" x2="757" y1="40.2969" y2="1140.6016"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="901" x2="901" y1="40.2969" y2="1140.6016"/><rect fill="#FEFECE" filter="url(#fabgl8ab4fgch)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="58" x="20" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="27" y="24.9951">Callee</text><rect fill="#FEFECE" filter="url(#fabgl8ab4fgch)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="58" x="20" y="1139.6016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="27" y="1159.5967">Callee</text><rect fill="#FEFECE" filter="url(#fabgl8ab4fgch)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="121" x="166.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="173.5" y="24.9951">PrincipalToken</text><rect fill="#FEFECE" filter="url(#fabgl8ab4fgch)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="121" x="166.5" y="1139.6016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="173.5" y="1159.5967">PrincipalToken</text><rect fill="#FEFECE" filter="url(#fabgl8ab4fgch)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="152" x="329" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="336" y="24.9951">KarmaCustomBond</text><rect fill="#FEFECE" filter="url(#fabgl8ab4fgch)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="152" x="329" y="1139.6016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="336" y="1159.5967">KarmaCustomBond</text><rect fill="#FEFECE" filter="url(#fabgl8ab4fgch)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="176" x="495" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="162" x="502" y="24.9951">KarmaCustomTreasury</text><rect fill="#FEFECE" filter="url(#fabgl8ab4fgch)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="176" x="495" y="1139.6016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="162" x="502" y="1159.5967">KarmaCustomTreasury</text><rect fill="#FEFECE" filter="url(#fabgl8ab4fgch)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="108" x="701" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="708" y="24.9951">PayoutToken</text><rect fill="#FEFECE" filter="url(#fabgl8ab4fgch)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="108" x="701" y="1139.6016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="708" y="1159.5967">PayoutToken</text><rect fill="#FEFECE" filter="url(#fabgl8ab4fgch)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="153" x="823" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="830" y="24.9951">KarmaDAOTreasury</text><rect fill="#FEFECE" filter="url(#fabgl8ab4fgch)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="153" x="823" y="1139.6016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="830" y="1159.5967">KarmaDAOTreasury</text><path d="M10,57.2969 L422,57.2969 L422,64.2969 L412,74.2969 L10,74.2969 L10,57.2969 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="226.7266" style="stroke:#000000;stroke-width:2.0;" width="485" x="10" y="57.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="367" x="25" y="70.3638">Transfer amount of principal token to the bond</text><polygon fill="#A80036" points="217,167.2266,227,171.2266,217,175.2266,221,171.2266" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="51" x2="223" y1="171.2266" y2="171.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="58" y="90.4966">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="126" y="90.4966">(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="74" y="105.6294">KarmaCustomBond,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="74" y="120.7622">amount, {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="82" y="135.895">"method": "deposit"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="74" y="151.0278">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="66" y="166.1606">)</text><polygon fill="#A80036" points="395,272.0234,405,276.0234,395,280.0234,399,276.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="229" x2="401" y1="276.0234" y2="276.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="106" x="236" y="195.2935">tokenFallback</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="346" y="195.2935">(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="252" y="210.4263">Callee,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="252" y="225.5591">amount, {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="260" y="240.6919">"method": "deposit"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="252" y="255.8247">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="244" y="270.9575">)</text><path d="M348,296.0234 L348,321.0234 L461,321.0234 L461,306.0234 L451,296.0234 L348,296.0234 " fill="#FBFB77" filter="url(#fabgl8ab4fgch)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M451,296.0234 L451,306.0234 L461,306.0234 L451,296.0234 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="92" x="354" y="313.0903">decayDebt()</text><path d="M156.5,337.1563 L608.5,337.1563 L608.5,344.1563 L598.5,354.1563 L156.5,354.1563 L156.5,337.1563 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="226.7266" style="stroke:#000000;stroke-width:2.0;" width="528.5" x="156.5" y="337.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="407" x="171.5" y="350.2231">Deposit the principal tokens to the Custom Treasury</text><polygon fill="#A80036" points="240,447.0859,230,451.0859,240,455.0859,236,451.0859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="234" x2="406" y1="451.0859" y2="451.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="246" y="370.356">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="314" y="370.356">(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="262" y="385.4888">KarmaCustomBond,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="262" y="400.6216">amount, {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="270" y="415.7544">"method": "deposit"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="262" y="430.8872">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="254" y="446.02">)</text><polygon fill="#A80036" points="573,551.8828,583,555.8828,573,559.8828,577,555.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="229" x2="579" y1="555.8828" y2="555.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="106" x="236" y="475.1528">tokenFallback</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="346" y="475.1528">(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="252" y="490.2856">Callee,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="252" y="505.4185">amount, {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="260" y="520.5513">"method": "deposit"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="252" y="535.6841">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="244" y="550.8169">)</text><path d="M319,577.8828 L731,577.8828 L731,584.8828 L721,594.8828 L319,594.8828 L319,577.8828 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="226.7266" style="stroke:#000000;stroke-width:2.0;" width="504" x="319" y="577.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="367" x="334" y="590.9497">Pay the payout token back to the Custom Bond</text><polygon fill="#A80036" points="745,687.8125,755,691.8125,745,695.8125,749,691.8125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="585" x2="751" y1="691.8125" y2="691.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="592" y="611.0825">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="660" y="611.0825">(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="608" y="626.2153">KarmaCustomBond,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="608" y="641.3481">amount, {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="616" y="656.481">"method": "pay"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="608" y="671.6138">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="600" y="686.7466">)</text><polygon fill="#A80036" points="418,792.6094,408,796.6094,418,800.6094,414,796.6094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="412" x2="756" y1="796.6094" y2="796.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="106" x="424" y="715.8794">tokenFallback</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="534" y="715.8794">(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="440" y="731.0122">Callee,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="440" y="746.145">amount, {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="448" y="761.2778">"method": "pay"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="440" y="776.4106">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="432" y="791.5435">)</text><path d="M156.5,818.6094 L462.5,818.6094 L462.5,825.6094 L452.5,835.6094 L156.5,835.6094 L156.5,818.6094 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="226.7266" style="stroke:#000000;stroke-width:2.0;" width="833.5" x="156.5" y="818.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="261" x="171.5" y="831.6763">Transfer fee to the DAO Treasury</text><polygon fill="#A80036" points="240,928.5391,230,932.5391,240,936.5391,236,932.5391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="234" x2="406" y1="932.5391" y2="932.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="246" y="851.8091">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="314" y="851.8091">(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="262" y="866.9419">KarmaCustomBond,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="262" y="882.0747">amount, {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="270" y="897.2075">"method": "deposit"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="262" y="912.3403">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="254" y="927.4731">)</text><polygon fill="#A80036" points="889.5,1033.3359,899.5,1037.3359,889.5,1041.3359,893.5,1037.3359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="229" x2="895.5" y1="1037.3359" y2="1037.3359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="106" x="236" y="956.606">tokenFallback</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="346" y="956.606">(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="252" y="971.7388">Callee,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="252" y="986.8716">amount, {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="260" y="1002.0044">"method": "deposit"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="252" y="1017.1372">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="244" y="1032.27">)</text><path d="M321,1057.3359 L321,1082.3359 L489,1082.3359 L489,1067.3359 L479,1057.3359 L321,1057.3359 " fill="#FBFB77" filter="url(#fabgl8ab4fgch)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M479,1057.3359 L479,1067.3359 L489,1067.3359 L479,1057.3359 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="147" x="327" y="1074.4028">Update totalDebt()</text><path d="M353,1096.4688 L353,1121.4688 L457,1121.4688 L457,1106.4688 L447,1096.4688 L353,1096.4688 " fill="#FBFB77" filter="url(#fabgl8ab4fgch)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M447,1096.4688 L447,1106.4688 L457,1106.4688 L447,1096.4688 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="83" x="359" y="1113.5356">Adjust BCV</text><!--MD5=[66e29c667834c4d2fe628738c0abc185]
@startuml
group Transfer amount of principal token to the bond
  Callee -> PrincipalToken : **transfer** ( \n    KarmaCustomBond, \n    amount, { \n      "method": "deposit" \n    } \n  )

  PrincipalToken -> KarmaCustomBond : **tokenFallback** ( \n    Callee, \n    amount, { \n      "method": "deposit" \n    } \n  )
end group

note over KarmaCustomBond : **decayDebt()**

group Deposit the principal tokens to the Custom Treasury
  KarmaCustomBond -> PrincipalToken : **transfer** ( \n    KarmaCustomBond, \n    amount, { \n      "method": "deposit" \n    } \n  )

  PrincipalToken -> KarmaCustomTreasury : **tokenFallback** ( \n    Callee, \n    amount, { \n      "method": "deposit" \n    } \n  )
end group

group Pay the payout token back to the Custom Bond
  KarmaCustomTreasury -> PayoutToken : **transfer** ( \n    KarmaCustomBond, \n    amount, { \n      "method": "pay" \n    } \n  )

  PayoutToken -> KarmaCustomBond : **tokenFallback** ( \n    Callee, \n    amount, { \n      "method": "pay" \n    } \n  )
  
end group


group Transfer fee to the DAO Treasury
  KarmaCustomBond -> PrincipalToken : **transfer** ( \n    KarmaCustomBond, \n    amount, { \n      "method": "deposit" \n    } \n  )

  PrincipalToken -> KarmaDAOTreasury : **tokenFallback** ( \n    Callee, \n    amount, { \n      "method": "deposit" \n    } \n  )
  
end group


note over KarmaCustomBond : **Update totalDebt()**

note over KarmaCustomBond : **Adjust BCV**
@enduml

PlantUML version 1.2022.1beta6(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>